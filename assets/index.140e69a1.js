import{q as Y,d as A,s as Z,r as l,a as O,x as P,H as Q,c as u,g as W,h as o,w as a,m as x,e as M,n as X,k as C,Y as ee,j as f,t as V,Z as te,I as oe,M as S,_ as T,f as ae}from"./index.caf5f627.js";import{d as se}from"./format.b40c70ff.js";const le={GetUsers:"/user/admin/users"};var ne={urlPrefix:""};function re(v,i,r){let c=JSON.parse(JSON.stringify(ne));return i.page=v.value.current,i.pageSize=v.value.pageSize,i.sortBy=r.value.sortBy,i.descending=r.value.descending,Y.get({url:le.GetUsers,params:i},c)}const ie={class:"list-common-table"},ue={class:"search-input"},ce={class:"table-container"},de={class:"left-operation-container"},pe="index",fe="top",ve=!0,_e=A({__name:"CommonTable",setup(v){const i=Z(),r=l(!1),c=l(""),g=l(!1),z=e=>{g.value=e};l(!1);const D=l();l();const K=[{title:"Username",fixed:"left",width:150,ellipsis:!0,align:"left",colKey:"username"},{title:"Role",colKey:"role",width:100},{title:"Parent",colKey:"parent",width:100},{title:"Register Region",colKey:"registerRegion",width:300},{title:"Register At",colKey:"registerAt",sorter:!0,width:150},{align:"left",width:100,colKey:"op",title:"Operation"}],d=l({role:"0"}),N=O(),n=l({current:1,previous:1,pageSize:10,total:100}),p=l({sortBy:"registerAt",descending:!0}),y=l([]),h=l(!1),_=async()=>{h.value=!0;var e={};c.value!=""&&(e.finds=c.value);try{const t=await re(n,e,p);y.value=[],t.list!=null&&(y.value=t.list),n.value={...n.value,total:t.count}}catch(t){console.log(t),t.response.status==401&&N.push("/login")}finally{h.value=!1}};P(()=>{_()}),window.addEventListener("message",e=>{e.data==="updateData"&&_()});const b=()=>{n.value.current=1,n.value.previous=n.value.current},B=e=>{b(),_()},q=e=>{B()},R=e=>{B()},I=(e,t)=>{console.log("[ rehandleChange ] changeParams: ",e),e.sorter?(p.value.sortBy=e.sorter.sortBy,p.value.descending=e.sorter.descending,b()):e.pagination||(p.value.sortBy=void 0,p.value.descending=void 0,b()),e.pagination&&(n.value.current=e.pagination.current,n.value.previous=e.pagination.previous,n.value.pageSize=e.pagination.pageSize),_()},L={role:[{required:!0,message:"Role is required",type:"error"}]},$=Q(()=>({offsetTop:i.isUseTabsRouter?48:0,container:`.${oe}-layout`})),F=()=>{r.value=!1,d.value={role:"0"}},G=e=>{r.value=!0,D.value=e.row,d.value.role=e.row.role},j=async({validateResult:e,firstError:t})=>{if(t)S.warning(t);else{try{S.success("Modify success")}catch(m){S.error(m.message)}r.value=!1}};return(e,t)=>{const m=u("t-input"),E=u("t-row"),U=u("t-form"),k=u("t-form-item"),w=u("t-button"),J=u("t-dialog"),H=u("t-table");return M(),W("div",ie,[o(U,{ref:"form","label-width":80,colon:"",style:{marginBottom:"8px"},onReset:q,onSubmit:R},{default:a(()=>[o(E,{justify:"space-between"},{default:a(()=>[x("div",ue,[o(m,{modelValue:c.value,"onUpdate:modelValue":t[0]||(t[0]=s=>c.value=s),placeholder:"Please input the username/email to search",class:X(["header-search",{"width-zero":!g.value}]),autofocus:g.value,onBlur:t[1]||(t[1]=s=>z(!1))},{"suffix-icon":a(()=>[o(C(ee),{size:"20px",onClick:R})]),_:1},8,["modelValue","class","autofocus"])])]),_:1})]),_:1},512),o(J,{visible:r.value,"onUpdate:visible":t[3]||(t[3]=s=>r.value=s),header:"Modify User Info",width:580,footer:!1},{body:a(()=>[o(U,{ref:"form",data:d.value,rules:L,"label-width":150,onSubmit:j},{default:a(()=>[o(k,{label:"Role",name:"role"},{default:a(()=>[o(m,{modelValue:d.value.role,"onUpdate:modelValue":t[2]||(t[2]=s=>d.value.role=s),style:{width:"380px"},placeholder:"Please input the role"},null,8,["modelValue"])]),_:1}),o(k,{style:{float:"right"}},{default:a(()=>[o(w,{variant:"outline",onClick:F},{default:a(()=>[f("Cancel")]),_:1}),o(w,{theme:"primary",type:"submit"},{default:a(()=>[f("Submit")]),_:1})]),_:1})]),_:1},8,["data"])]),_:1},8,["visible"]),x("div",ce,[o(H,{data:y.value,columns:K,"row-key":pe,"vertical-align":fe,hover:ve,pagination:n.value,loading:h.value,"header-affixed-top":$.value,onChange:I},{role:a(({row:s})=>[f(V(C(te)(s.role)),1)]),registerAt:a(({row:s})=>[f(V(C(se)(s.registerAt)),1)]),op:a(s=>[x("div",de,[o(w,{onClick:he=>G(s)},{default:a(()=>[f(" Modify ")]),_:2},1032,["onClick"])])]),_:1},8,["data","pagination","loading","header-affixed-top"])])])}}});var me=T(_e,[["__scopeId","data-v-1c39623a"],["__file","/Users/mbp13/git/deepeye/app-deepeye/src/pages/admin/user/components/CommonTable.vue"]]);const ge={name:"ListFilter"},ye=A({...ge,setup(v){return(i,r)=>(M(),ae(me))}});var xe=T(ye,[["__file","/Users/mbp13/git/deepeye/app-deepeye/src/pages/admin/user/index.vue"]]);export{xe as default};
